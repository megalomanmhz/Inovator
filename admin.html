<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>Admin Dashboard</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
body{font-family:system-ui;background:#f3f4f6;padding:20px}
.card{background:#fff;padding:15px;border-radius:10px;margin-bottom:15px}
input,button{padding:8px;width:100%;margin:6px 0}
button{background:#059669;color:#fff;border:none}
</style>
</head>
<body>

<h2>ðŸ•Œ Admin Dashboard</h2>

<div id="login" class="card">
<input id="key" type="password" placeholder="Password Takmir">
<button onclick="login()">Login</button>
</div>

<div id="panel" style="display:none">
<div class="card">
<h4>ðŸ“Š Statistik</h4>
<canvas id="chart"></canvas>
</div>

<div class="card">
<h4>ðŸŽ« Voucher Ustaz</h4>
<input id="voucher">
<button onclick="addVoucher()">Tambah Voucher</button>
<pre id="config"></pre>
</div>
</div>

<script>
let KEY="";

async function login(){
 KEY=document.getElementById("key").value;
 const r=await fetch("/api/admin-stats",{headers:{"x-admin-key":KEY}});
 if(r.status!==200) return alert("Password salah");
 document.getElementById("login").style.display="none";
 document.getElementById("panel").style.display="block";
 load();
}

async function load(){
 const s=await fetch("/api/admin-stats",{headers:{"x-admin-key":KEY}});
 const d=await s.json();
 new Chart(document.getElementById("chart"),{
  type:"line",
  data:{labels:Object.keys(d.perHari),datasets:[{data:Object.values(d.perHari)}]}
 });

 const c=await fetch("/api/admin-config",{headers:{"x-admin-key":KEY}});
 document.getElementById("config").innerText=JSON.stringify(await c.json(),null,2);
}

async function addVoucher(){
 const v=document.getElementById("voucher").value;
 const c=await fetch("/api/admin-config",{method:"POST",headers:{
  "Content-Type":"application/json","x-admin-key":KEY
 },body:JSON.stringify({ustazVouchers:[v]})});
 document.getElementById("config").innerText=JSON.stringify(await c.json(),null,2);
}
</script>

</body>
</html>
